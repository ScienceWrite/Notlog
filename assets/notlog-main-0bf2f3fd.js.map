{"version":3,"file":"notlog-main-0bf2f3fd.js","sources":["../../src/notlog-main.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\nimport { bootstrapExtra } from \"@workadventure/scripting-api-extra\";\nimport { checkPlayerMaterial, mySound, playRandomSound } from \"./footstep\";\nimport { getChatAreas } from \"./chatArea\";\nimport { quests, levelUp } from \"./quests\";\n\nWA.onInit().then(async () => {\n    WA.state.playerName = WA.player.name;\n    console.log('loading main.ts');\n    WA.controls.disableInviteButton();\n    WA.controls.disableMapEditor();\n    WA.controls.disableRoomList();\n\n    // Initialize the first quest if not already set\n    if (!WA.player.state.currentQuest) {\n        WA.player.state.currentQuest = 'quest1';\n    }\n    levelUp(\"notlog\", 0);\n\n    try {\n        // Initialize the Scripting API Extra\n        await bootstrapExtra();\n        console.log('Scripting API Extra ready');\n    } catch (e) {\n        console.error(e);\n    }\n    WA.onInit().then(async () => {\n    // Get chat areas and set up event listeners for entering and leaving them\n    const chatAreas = await getChatAreas();\n    for (const area of chatAreas) {\n        let triggerMessage: any;\n        let playerName: string = WA.player.name;\n        console.log(\"Player name:\", playerName);\n        // When player enters a chat area\n        WA.room.area.onEnter(area.name).subscribe(() => {\n            triggerMessage = WA.ui.displayActionMessage({\n                message: `[LEERTASTE] drücken um mit ${area.npcName} zu sprechen.`,\n                callback: () => {\n\n                    \n                    WA.chat.sendChatMessage(area.chatText.replace(\"{NameOfPlayer}\", playerName),area.npcName);\n                    if (area.triggerQuest) {\n                        const currentQuest = WA.player.state.currentQuest;\n                        const requiredQuest = quests.find((q: { questId: string }) => q.questId === area.triggerQuest)?.requireQuest;\n                        if (currentQuest === requiredQuest) {\n                            WA.player.state.currentQuest = area.triggerQuest;\n                        }\n                    }\n                }\n            });\n            WA.room.area.onLeave(area.name).subscribe(() => {WA.chat.close();});\n        });\n\n        // When player leaves a chat area\n        WA.room.area.onLeave(area.name).subscribe(() => {\n            if (triggerMessage) {\n                triggerMessage.remove();\n                WA.chat.close();\n            }\n        });\n    }\n    });\n    \n    // Event listener for player movement to play footstep sounds\n    WA.player.onPlayerMove(async ({ x, y, moving }) => {\n        const material = await checkPlayerMaterial({ x, y });\n        if (!material) {\n            mySound?.stop();\n            return;\n        }\n\n        if (!moving && !material) {\n            mySound?.stop();\n            return;\n        } else {\n            mySound?.stop();\n            playRandomSound(material);\n        }\n    });\n\n   \n    // Check if the player has solved the notlog quest and is not an admin\n    const solvedNotlog = WA.player.state.solvedNotlog;\n    const isAdmin = WA.player.tags.includes('admin');\n    const mapURL = WA.room.mapURL;\n\n    console.log(\"solvedNotlog:\", solvedNotlog);\n    console.log(\"isAdmin:\", isAdmin);\n    console.log(\"mapURL:\", mapURL);\n\n    if (solvedNotlog === true && !isAdmin && mapURL.includes('notlog') && !mapURL.includes('localhost')) {\n        console.log(\"Map URL: \", mapURL);\n        // Teleport the player to the entry named \"matrix-hub\"\n        WA.nav.goToRoom(\"./matrix-hub.tmj\");\n    }\n\n    // Event listener for entering the notlog area\n    WA.room.area.onEnter('notlog').subscribe(() => {\n        console.log(\"Entered notlog area\");\n        if (solvedNotlog === true && !isAdmin) {\n            console.log(\"Map URL: \", mapURL);\n            if (!mapURL.includes('localhost')) {\n                // Teleport the player to the entry named \"matrix-hub\"\n                WA.nav.goToRoom(\"./matrix-hub.tmj\");\n            }\n        }\n    });\n\n    // Event listener for leaving the notlog area\n    WA.room.area.onEnter('leaveNotlog').subscribe(() => {\n        console.log(\"Leaving notlog area\");\n        WA.player.state.solvedNotlog = true;\n        WA.player.state.currentQuest = 'quest6';\n    });\n\n    // Display the current quest banner if a quest is active\n    const currentQuestId = WA.player.state.currentQuest;\n    const currentQuest = quests.find((q: { questId: string }) => q.questId === currentQuestId);\n    if (currentQuest) {\n        createQuestBanner(currentQuest.questId);\n    }\n\n    // Event listener for changes in the current quest\n    WA.player.state.onVariableChange('currentQuest').subscribe((newQuestId) => {\n        levelUp(\"notlog\", 1);\n        const newQuest = quests.find((q: { questId: string }) => q.questId === newQuestId);\n        if (newQuest) {\n            createQuestBanner(newQuest.questId);\n        }\n    });\n\n    // Function to create a quest banner\n    function createQuestBanner(questId: string) {\n        const quest = quests.find((q: { questId: string }) => q.questId === questId);\n        if (quest) {\n            WA.ui.banner.openBanner({\n                id: quest.questId,\n                text: quest.questDescription,\n                bgColor: '#1B1B29',\n                textColor: '#FFFFFF',\n                timeToClose: 0,\n                closable: false\n            });\n        }\n    }\n});\n\n\nWA.player.state.onVariableChange('Einführungsvideo').subscribe((newValue) => {\n    if (newValue === \"solved\" ) {\n        console.log(`Einführungsvideo\" solved. Level up, +10XP`);\n        WA.player.state.currentQuest = \"quest5\";\n    }\n});\n\n\n\nexport {};\n\n"],"names":["levelUp","bootstrapExtra","e","chatAreas","getChatAreas","area","triggerMessage","playerName","currentQuest","requiredQuest","_a","quests","q","x","y","moving","material","checkPlayerMaterial","mySound","_b","_c","playRandomSound","solvedNotlog","isAdmin","mapURL","currentQuestId","createQuestBanner","newQuestId","newQuest","questId","quest","newValue"],"mappings":"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"}